<template>
  <div :class="prefixCls">
    <div ref="editor" class="editor-wrapper"></div>
  </div>
</template>

<script>
import WEditor from "wangeditor";

export default {
  name: "WangEditor",
  props: {
    prefixCls: {
      type: String,
      default: "my-editor"
    },
    // eslint-disable-next-line
    value: {
      type: String,
      default: ""
    },
    isClear: {
      type: Boolean,
      default: false
    }
  },
  data() {
    return {
      editor: null,
      editorContent: null
    };
  },
  watch: {
    isClear(val) {
      // è§¦å‘æ¸…é™¤æ–‡æœ¬åŸŸå†…å®¹
      if (val) {
        this.editor.txt.clear();
        this.editorContent = null;
      }
    }
  },
  mounted() {
    this.initEditor();
  },
  methods: {
    getText() {
      this.editor.txt.text();
    },
    setText(val) {
      this.editor.txt.html(val);
    },
    initEditor() {
      this.editor = new WEditor(this.$refs.editor);
      // this.editor = new E(this.$refs.toolbar, this.$refs.editor)
      this.editor.customConfig.uploadImgShowBase64 = false; // base 64 å­˜å‚¨å›¾ç‰‡
      this.editor.customConfig.showLinkImg = false;//å…³é—­é€šè¿‡å›¾ç‰‡åœ°å€æ·»åŠ å›¾ç‰‡
      this.editor.customConfig.uploadImgServer =
        "http://xxx.com/upload"; //å¦‚æœéœ€è¦æœ¬åœ°ä¸Šä¼ å›¾ç‰‡ éœ€é…ç½®ä¸Šä¼ å›¾ç‰‡æœåŠ¡å™¨åœ°å€ æ‰¾åç«¯è¦
      this.editor.customConfig.uploadImgHeaders = {}; // è‡ªå®šä¹‰ header
      this.editor.customConfig.uploadFileName = "file"; // åç«¯æ¥å—ä¸Šä¼ æ–‡ä»¶çš„å‚æ•°å
      this.editor.customConfig.uploadImgMaxSize = 2 * 1024 * 1024; // å°†å›¾ç‰‡å¤§å°é™åˆ¶ä¸º 2M
      this.editor.customConfig.uploadImgMaxLength = 6; // é™åˆ¶ä¸€æ¬¡æœ€å¤šä¸Šä¼  3 å¼ å›¾ç‰‡
      this.editor.customConfig.uploadImgTimeout = 3 * 60 * 1000; // è®¾ç½®è¶…æ—¶æ—¶é—´
      this.editor.customConfig.emotions = [
        {
          // tab çš„æ ‡é¢˜
          title: "é»˜è®¤",
          // type -> 'emoji' / 'image'
          type: "image",
          // content -> æ•°ç»„//è‡ªå®šä¹‰è¡¨æƒ…æ ¹æ®æ–‡æ¡£ è‡ªè¡Œæ·»åŠ 
          content: [
            {
              alt: "[å¾®ç¬‘]",
              type: "face",
              src:
                "http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/e3/2018new_weixioa02_org.png"
            },
            {
              alt: "[å¯çˆ±]",
              type: "face",
              src:
                "http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/09/2018new_keai_org.png"
            },
            {
              alt: "[ç©ºæ˜Ÿ]",
              src:
                "http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/ff/hot_blankstar_org.png"
            }
          ]
        },
        {
          // tab çš„æ ‡é¢˜
          title: "emoji",
          // type -> 'emoji' / 'image'
          type: "emoji",
          // content -> æ•°ç»„ è‡ªå®šä¹‰è¡¨æƒ…æ ¹æ®æ–‡æ¡£ è‡ªè¡Œæ·»åŠ 
          content: [
            "ğŸ˜€",
            "ğŸ˜ƒ",
            "ğŸ˜„",
            "ğŸ˜",
            "ğŸ˜†",
            "ğŸ¤£",
            "ğŸ˜„",
            "ğŸ˜…",
            "ğŸ˜†",
            "ğŸ˜‰",
            "ğŸ˜Š",
            "ğŸ˜‹",
            "ğŸ˜",
            "ğŸ˜",
            "ğŸ˜˜",
            "ğŸ˜—",
            "ğŸ˜š",
            "ğŸ™‚",
            "ğŸ¤—",
            "ğŸ¤”",
            "ğŸ˜³",
            "ğŸ˜‘",
            "ğŸ˜¶",
            "ğŸ™„",
            "ğŸ˜",
            "ğŸ˜£",
            "ğŸ˜¥",
            "ğŸ˜®",
            "ğŸ¤",
            "ğŸ˜¯",
            "ğŸ˜ª",
            "ğŸ˜«",
            "ğŸ˜´",
            "ğŸ˜Œ",
            "ğŸ˜›",
            "ğŸ˜œ",
            "ğŸ˜’",
            "ğŸ˜“",
            "ğŸ˜•",
            "ğŸ™ƒ",
            "ğŸ˜²",
            "ğŸ™",
            "ğŸ˜–",
            "ğŸ˜¤",
            "ğŸ˜­",
            "ğŸ˜¨",
            "ğŸ˜¬",
            "ğŸ˜±",
            "ğŸ˜¡",
            "ğŸ˜ ",
            "ğŸ˜·",
            "ğŸ¤’",
            "ğŸ¤§",
            "ğŸ¤¡",
            "ğŸ˜ˆ",
            "ğŸ’€",
            "ğŸ‘»",
            "ğŸ‘½",
            "ğŸ’©",
            "ğŸ˜º",
            "ğŸ˜¸",
            "ğŸ˜¹",
            "ğŸ˜»",
            "ğŸ˜¼",
            "ğŸ˜½",
            "ğŸ™€",
            "ğŸ˜¿",
            "ğŸ˜¾",
            "ğŸ’–",
            "ğŸ’—",
            "ğŸ’Ÿ",
            "ğŸ’¤",
            "ğŸ’¢",
            "ğŸ‘ˆ",
            "ğŸ‘‰",
            "â˜",
            "ğŸ‘†",
            "âœŒ",
            "ğŸ‘Œ",
            "ğŸ‘",
            "ğŸ‘Œ",
            "ğŸ‘",
            "âœŠ",
            "ğŸ¤›",
            "ğŸ¤œ",
            "ğŸ‘",
            "ğŸ™",
            "ğŸ¤",
            "ğŸŒ¹",
            "ğŸ¥€"
          ]
        }
      ];
      // é…ç½®èœå• å¯æ ¹æ®æ–‡æ¡£è¿›è¡Œæ·»åŠ 
      this.editor.customConfig.menus = [
        // 'head', // æ ‡é¢˜
        // 'bold', // ç²—ä½“
        "fontSize", // å­—å·
        // 'fontName', // å­—ä½“
        // 'italic', // æ–œä½“
        "underline", // ä¸‹åˆ’çº¿
        // 'strikeThrough', // åˆ é™¤çº¿
        "foreColor", // æ–‡å­—é¢œè‰²
        "backColor", // èƒŒæ™¯é¢œè‰²
        // 'link', // æ’å…¥é“¾æ¥
        "list", // åˆ—è¡¨
        "justify", // å¯¹é½æ–¹å¼
        "image", // æ’å…¥å›¾ç‰‡
        // 'quote', // å¼•ç”¨
        "emoticon" // è¡¨æƒ…
        // 'table', // è¡¨æ ¼
        // 'video', // æ’å…¥è§†é¢‘
        // 'code', // æ’å…¥ä»£ç 
        // 'undo', // æ’¤é”€
        // 'redo', // é‡å¤
        // 'fullscreen' // å…¨å±
      ];

      this.editor.customConfig.uploadImgHooks = {
        fail: (xhr, editor, result) => {
          // æ’å…¥å›¾ç‰‡å¤±è´¥å›è°ƒ
          console.log(xhr, editor, result);
        },
        success: (xhr, editor, result) => {
          // å›¾ç‰‡ä¸Šä¼ æˆåŠŸå›è°ƒ
          console.log(xhr, editor, result);
        },
        timeout: (xhr, editor) => {
          // ç½‘ç»œè¶…æ—¶çš„å›è°ƒ
          console.log(xhr, editor);
        },
        error: (xhr, editor) => {
          // å›¾ç‰‡ä¸Šä¼ é”™è¯¯çš„å›è°ƒ
          console.log(xhr, editor);
        },
        customInsert: (insertImg, result, editor) => {
          // å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼Œæ’å…¥å›¾ç‰‡çš„å›è°ƒ
          // resultä¸ºä¸Šä¼ å›¾ç‰‡æˆåŠŸçš„æ—¶å€™è¿”å›çš„æ•°æ®ï¼Œè¿™é‡Œæˆ‘æ‰“å°äº†ä¸€ä¸‹å‘ç°åå°è¿”å›çš„æ˜¯result.dataï¼š[{"è·¯å¾„çš„å½¢å¼"},...]
          // console.log('result.data[0].url', result.data[0].url)
          // insertImg()ä¸ºæ’å…¥å›¾ç‰‡çš„å‡½æ•°
          // å¾ªç¯æ’å…¥å›¾ç‰‡
          console.log(editor);
          for (let i = 0; i < 1; i++) {
            console.log("result", result); // æ ¹æ®æ ¼å¼æ¥èµ‹å€¼
            const src = "http://" + result.data.url; // å¦‚æœè¿”å›çš„æ˜¯å®Œæ•´çš„srcå°±ä¸ç”¨æ‹¼æ¥ !!!!è¿™é‡Œéœ€è¦æ³¨æ„
            insertImg(src);
          }
        }
      };
      // åˆ›å»ºå¯Œæ–‡æœ¬ç¼–è¾‘å™¨
      this.editor.customConfig.onchange = html => {
        let str = html;
        str = str.replace(/\bm.*?;/, "width:300px"); //æ›´æ”¹æ’å…¥åˆ°å¯Œæ–‡æœ¬é‡Œå›¾ç‰‡çš„å®½åº¦
        this.editorContent = str;
        this.$emit("change", this.editorContent); // å°†å†…å®¹åŒæ­¥åˆ°çˆ¶ç»„ä»¶ä¸­
      };
      this.editor.customConfig.zIndex = 2; // é…ç½®å¯Œæ–‡æœ¬çš„æƒé‡ ä¸ç„¶ä¼šè¦†ç›–å…¶ä»–ç»„ä»¶
      this.editor.create();
    }
  }
};
</script>

<style lang="scss" scoped>
.my-editor {
  .editor-wrapper {
    text-align: left;
  }
}
</style>